<?xml version="1.0" encoding="UTF-8"?>
<prompt>
  <!-- Instructions and Role at the start -->
  <instructions>
    <role>You are an expert AI assistant. You will analyze the provided project information, structure, and context, then provide a detailed and compliant answer to the final request.</role>
    <goal>
      Your goal is to carefully read and understand the project's instructions, objectives, code structure, and all related guidelines, then produce a final answer that addresses the final request accurately and thoroughly.
    </goal>
    <note>
      After reviewing all the information below (project instructions, code structure, conventions, etc.), you will answer the final request while adhering to all given rules and guidelines.
    </note>
  </instructions>

  <project_instructions>
    <project_name>{{ project_name }}</project_name>
    <objectives>
      {% for obj in objectives %}
      <objective>{{ obj }}</objective>
      {% endfor %}
    </objectives>
    <code_conventions>
      <language_stack>
        <frontend>{{ frontend_stack }}</frontend>
        <backend>{{ backend_stack }}</backend>
      </language_stack>
      <directories_structure>
        <frontend>{{ directories_frontend }}</frontend>
        <backend>{{ directories_backend }}</backend>
      </directories_structure>
      <coding_style>
        {% for rule in coding_style %}
        <rule>{{ rule }}</rule>
        {% endfor %}
      </coding_style>
    </code_conventions>
    <privacy_and_legal>
      {% for pl in privacy_and_legal %}
      <item>{{ pl }}</item>
      {% endfor %}
    </privacy_and_legal>
    <performance_and_architecture>
      {% for pa in performance_and_arch %}
      <item>{{ pa }}</item>
      {% endfor %}
    </performance_and_architecture>
    <ux_guidelines>
      {% for ux in ux_guidelines %}
      <item>{{ ux }}</item>
      {% endfor %}
    </ux_guidelines>
    <advertising>
      {% for ad in advertising %}
      <item>{{ ad }}</item>
      {% endfor %}
    </advertising>
    <evolutivity>
      {% for ev in evolutivity %}
      <item>{{ ev }}</item>
      {% endfor %}
    </evolutivity>
  </project_instructions>

  <project_structure>
    {{ code_structure | safe }}
  </project_structure>

  <codebase_context>
    <files>
    {% for f in files_info %}
      <file>
        <path>{{ f.find('path').text.strip() }}</path>
        <description>{{ f.find('description').text.strip() }}</description>
      </file>
    {% endfor %}
    </files>
  </codebase_context>

  <full_code_context>
    <files>
    {% for file_item in code_files %}
      <file>
        <path>{{ file_item.path }}</path>
        <language>{{ file_item.language }}</language>
        <lines>
          {% for line in file_item.lines %}
          <line number="{{ line.number }}">{{ line.text }}</line>
          {% endfor %}
        </lines>
      </file>
    {% endfor %}
    </files>
  </full_code_context>

  <format>
    <selected>{{ chosen_format }}</selected>
    <instructions>
      {% for instr in format_instructions %}
      <instruction>{{ instr }}</instruction>
      {% endfor %}
    </instructions>
    <examples>
      {% for ex in format_examples %}
      <example>{{ ex }}</example>
      {% endfor %}
    </examples>
  </format>

  <!-- Highlight the final request -->
  <request>
    <introduction>
      The final request is presented below. This is your main task: to answer it thoroughly and accurately, considering all the information provided above.
    </introduction>
    <final_request>{{ request }}</final_request>
  </request>
</prompt>
