<?xml version='1.0' encoding='utf-8'?>
<code_context><file path="README.md"><code language="markdown"><line number="1"># AI Prompt Tool</line><line number="2" /><line number="3">## Project Overview</line><line number="4" /><line number="5">The AI Prompt Tool is a sophisticated system designed to generate structured prompts for AI models. It analyzes a given codebase, extracts relevant information, and creates a comprehensive prompt that includes project instructions, structure, context, and specific requests.</line><line number="6" /><line number="7">## Project Structure</line><line number="8" /><line number="9">The project is organized into the following main components:</line><line number="10" /><line number="11">- `config/`: Contains configuration files for project instructions, codebase context, settings, and formats.</line><line number="12">- `data/`: Stores generated data such as code structure, context, and the final prompt.</line><line number="13">- `scripts/`: Houses Python scripts for generating project structure and prompts.</line><line number="14">- `templates/`: Contains the Jinja2 template for the final prompt.</line><line number="15" /><line number="16">Key files:</line><line number="17">- `run_full_process.sh`: Main script to execute the entire prompt generation process.</line><line number="18">- `scripts/generate_structure.py`: Generates the project structure and code context.</line><line number="19">- `scripts/generate_prompt.py`: Creates the final prompt using the gathered information.</line><line number="20">- `templates/prompt_template.jinja2`: Template for structuring the final prompt.</line><line number="21">- `config/settings.yaml`: Contains settings such as the source directory.</line><line number="22">- `config/final_request.txt`: Contains the specific request for the AI model.</line><line number="23" /><line number="24">## How It Works</line><line number="25" /><line number="26">1. The `run_full_process.sh` script orchestrates the entire process:</line><line number="27">   - Checks for required directories and files.</line><line number="28">   - Reads the source directory from settings.</line><line number="29">   - Runs `generate_structure.py` to analyze the project structure.</line><line number="30">   - Executes `generate_prompt.py` to create the final prompt.</line><line number="31" /><line number="32">2. `generate_structure.py`:</line><line number="33">   - Scans the project directory specified in `config/settings.yaml`.</line><line number="34">   - Generates `data/code_structure.json`: A JSON representation of the project structure.</line><line number="35">   - Creates `data/code_context.md`: A Markdown file containing relevant code snippets and context.</line><line number="36" /><line number="37">3. `generate_prompt.py`:</line><line number="38">   - Loads configuration files from the `config/` directory.</line><line number="39">   - Formats the loaded data into structured sections.</line><line number="40">   - Uses the Jinja2 template to render the final prompt.</line><line number="41">   - Outputs the generated prompt to stdout, which is then redirected to `data/final_prompt.txt`.</line><line number="42" /><line number="43">4. The final prompt includes:</line><line number="44">   - Project instructions</line><line number="45">   - Project structure</line><line number="46">   - Codebase context</line><line number="47">   - Full code context</line><line number="48">   - Expected response format</line><line number="49">   - Specific request (from `config/final_request.txt`)</line><line number="50" /><line number="51">## Usage</line><line number="52" /><line number="53">1. Ensure all required directories and configuration files are present.</line><line number="54">2. Customize the configuration files in the `config/` directory as needed.</line><line number="55">3. Run the main script:</line><line number="56">   ```</line><line number="57">   ./run_full_process.sh</line><line number="58">   ```</line><line number="59">4. When prompted, confirm that you want to proceed with scanning the project source directory.</line><line number="60">5. The generated prompt will be saved in `data/final_prompt.txt`.</line><line number="61">6. Use the content of `data/final_prompt.txt` with your AI assistant or model.</line><line number="62" /><line number="63">## Customization</line><line number="64" /><line number="65">- Modify `config/project_instructions.yaml` to update project-specific instructions.</line><line number="66">- Edit `config/codebase_context.yaml` to provide context for key files in your project.</line><line number="67">- Adjust format files in `config/formats/` to specify the desired format for AI responses.</line><line number="68">- Update `config/settings.yaml` to change the source directory or other settings.</line><line number="69">- Modify `config/final_request.txt` to customize the specific request for the AI model.</line><line number="70" /><line number="71">## Note</line><line number="72" /><line number="73">This tool is designed to create structured and context-rich prompts for AI models, particularly useful for code analysis, refactoring suggestions, or answering specific questions about a codebase. The generated prompt provides a comprehensive overview of the project, allowing the AI to give more accurate and relevant responses.</line><line number="74" /><line number="75">After generating the prompt, the script will display the character count and an estimated token count for the generated prompt, which can be useful for managing token limits in AI models.</line><line number="76" /></code></file><file path="run_full_process.sh"><code language="none"><line number="1">#!/usr/bin/env bash</line><line number="2" /><line number="3">set -e</line><line number="4" /><line number="5">echo "Checking required directories..."</line><line number="6">REQUIRED_DIRS=("config" "data" "templates" "scripts")</line><line number="7">for d in "${REQUIRED_DIRS[@]}"; do</line><line number="8">    if [ ! -d "$d" ]; then</line><line number="9">        echo "Error: Directory '$d' not found."</line><line number="10">        exit 1</line><line number="11">    fi</line><line number="12">done</line><line number="13" /><line number="14">echo "Checking required config files..."</line><line number="15">REQUIRED_CONFIG=("config/project_instructions.xml" "config/codebase_context.xml" "config/settings.yaml" "config/final_request.xml")</line><line number="16">for f in "${REQUIRED_CONFIG[@]}"; do</line><line number="17">    if [ ! -f "$f" ]; then</line><line number="18">        echo "Error: Configuration file '$f' not found."</line><line number="19">        exit 1</line><line number="20">    fi</line><line number="21">done</line><line number="22" /><line number="23">if [ ! -d "config/formats" ]; then</line><line number="24">    echo "Error: 'config/formats' directory not found."</line><line number="25">    exit 1</line><line number="26">fi</line><line number="27" /><line number="28">if [ ! -f "templates/prompt_template.xml.jinja2" ]; then</line><line number="29">    echo "Error: Template file 'prompt_template.xml.jinja2' not found."</line><line number="30">    exit 1</line><line number="31">fi</line><line number="32" /><line number="33">if [ ! -f "scripts/generate_structure.py" ] || [ ! -f "scripts/generate_prompt.py" ]; then</line><line number="34">    echo "Error: Required scripts not found."</line><line number="35">    exit 1</line><line number="36">fi</line><line number="37" /><line number="38"># On ne lit plus la source_directory depuis XML mais depuis YAML directement dans les scripts</line><line number="39">ABS_SOURCE_DIR=$(pwd)</line><line number="40">echo "We are about to scan the project source directory at: $ABS_SOURCE_DIR"</line><line number="41" /><line number="42">echo "Running generate_structure.py..."</line><line number="43">python3 scripts/generate_structure.py</line><line number="44" /><line number="45">if [ ! -f "data/code_structure.xml" ]; then</line><line number="46">    echo "Error: 'data/code_structure.xml' not found after running generate_structure.py."</line><line number="47">    exit 1</line><line number="48">fi</line><line number="49" /><line number="50">if [ ! -f "data/code_context.xml" ]; then</line><line number="51">    echo "Warning: 'data/code_context.xml' not found. Possibly no files included."</line><line number="52">fi</line><line number="53" /><line number="54">echo "Formats disponibles :"</line><line number="55">for file in config/formats/*.xml; do</line><line number="56">    base=$(basename "$file" .xml)</line><line number="57">    echo "- $base"</line><line number="58">done</line><line number="59" /><line number="60">read -p "Veuillez saisir un format : " USER_FORMAT</line><line number="61">USER_FORMAT=$(echo "$USER_FORMAT" | tr '[:upper:]' '[:lower:]')</line><line number="62" /><line number="63">if [ ! -f "config/formats/$USER_FORMAT.xml" ]; then</line><line number="64">    echo "Erreur : Le format '$USER_FORMAT' n'est pas supporté."</line><line number="65">    exit 1</line><line number="66">fi</line><line number="67" /><line number="68">echo "Running generate_prompt.py..."</line><line number="69">python3 scripts/generate_prompt.py "$USER_FORMAT" | tee data/final_prompt.xml</line><line number="70" /><line number="71">if [ ! -f "data/final_prompt.xml" ]; then</line><line number="72">    echo "Error: 'data/final_prompt.xml' was not created."</line><line number="73">    exit 1</line><line number="74">fi</line><line number="75" /><line number="76">CHAR_COUNT=$(wc -m &lt; data/final_prompt.xml | tr -d '[:space:]')</line><line number="77">TOKEN_ESTIMATE=$((CHAR_COUNT / 4))</line><line number="78" /><line number="79">echo "----------------------------------------"</line><line number="80">echo "Prompt successfully generated and saved to data/final_prompt.xml"</line><line number="81">echo "Character count: $CHAR_COUNT"</line><line number="82">echo "Estimated tokens (approx): $TOKEN_ESTIMATE"</line><line number="83">echo "----------------------------------------"</line><line number="84">echo "Process completed successfully."</line><line number="85" /></code></file><file path="projet_instruction.md"><code language="markdown"><line number="1">**Objectif du projet :**</line><line number="2" /><line number="3">Créer une borne tactile pour magasins physiques (ex. : Décathlon), permettant aux clients d’essayer virtuellement des vêtements via une technologie de "try-on". L’utilisateur suit un parcours fluide, de la capture d’une photo à la génération des résultats, dans une interface immersive inspirée d’un miroir connecté, avec possibilité de changer la langue de l’interface et de réutiliser des images déjà générées pour de nouveaux essais.</line><line number="4" /><line number="5">---</line><line number="6" /><line number="7">**Gestion multilingue** :</line><line number="8" /><line number="9">- L’interface est conçue pour supporter plusieurs langues.</line><line number="10">- Un système de gestion des langues (fichiers de traduction, variables dynamiques, etc.) doit être en place.</line><line number="11">- Un indicateur (drapeau) visible en haut de l’interface permet de changer facilement la langue.</line><line number="12">- Le changement de langue prend effet immédiatement sur l’ensemble de l’interface.</line><line number="13" /><line number="14">---</line><line number="15" /><line number="16">**Parcours utilisateur et écrans :**</line><line number="17" /><line number="18">**1. Écran d’accueil (avant la session) :**</line><line number="19" /><line number="20">- Affiche le flux vidéo de la webcam en plein écran, comme un miroir connecté.</line><line number="21">- Un bouton "Let’s Play" est superposé, ainsi qu’un cadre pointillé pour aider l’utilisateur à se positionner.</line><line number="22">- Le drapeau indiquant la langue actuelle est visible en haut, permettant de changer la langue.</line><line number="23">- L’utilisateur clique sur "Let’s Play" pour lancer le processus.</line><line number="24" /><line number="25">**2. Modal de consentement légal :**</line><line number="26" /><line number="27">- Une modal apparaît, demandant à l’utilisateur d’accepter les conditions d’utilisation et la sauvegarde de ses photos.</line><line number="28">- S’il accepte, on passe à l’étape suivante. S’il refuse, retour à l’écran d’accueil.</line><line number="29" /><line number="30">**3. Décompte et tutoriel de placement :**</line><line number="31" /><line number="32">- Un décompte de 10s démarre après l’acceptation.</line><line number="33">- Pendant les 5 premières secondes, un modal semi-transparent affiche des tutoriels visuels et textuels pour aider l’utilisateur à se positionner.</line><line number="34">- Passées ces 5s, le modal disparaît, laissant uniquement le décompte.</line><line number="35">- À 0s, la photo initiale est prise.</line><line number="36" /><line number="37">**4. Modal de validation de la photo :**</line><line number="38" /><line number="39">- La photo capturée est affichée en grand.</line><line number="40">- L’utilisateur peut confirmer la photo ou la reprendre (réinitialisant le décompte et le tutoriel).</line><line number="41">- Si confirmée, la session démarre et l’image initiale est sauvegardée en base de données.</line><line number="42" /><line number="43">**5. Écran principal (après validation de la photo initiale) :**</line><line number="44" /><line number="45">- La vue webcam plein écran est remplacée par l’affichage de la photo sélectionnée. La webcam n’est plus affichée après cette étape.</line><line number="46">- À gauche, une barre verticale affiche l’historique :</line><line number="47">    - La photo initiale en haut.</line><line number="48">    - Les nouvelles photos générées seront ajoutées juste en dessous de la photo initiale, créant une liste verticale. Chaque nouvelle génération s’ajoute directement sous l’image initiale, en gardant l’ordre chronologique (la plus récente se retrouve immédiatement sous l’originale).</line><line number="49">- L’utilisateur peut cliquer sur n’importe quelle photo de l’historique pour la sélectionner. **La photo sélectionnée (qu’elle soit l’originale ou une image générée précédemment) est utilisée comme base pour la prochaine génération.** Ainsi, l’utilisateur peut faire un try-on à partir de n’importe quelle image déjà présente dans l’historique.</line><line number="50">- En haut, une barre horizontale présente les catégories de vêtements (T-shirts, Jeans, Pulls, etc.) ainsi que le drapeau de langue.</line><line number="51">- Cliquer sur une catégorie ouvre un modal transparent affichant les différents vêtements de cette catégorie.</line><line number="52">- Le modal transparent laisse voir l’image sélectionnée en fond.</line><line number="53">- En cliquant sur un vêtement, la génération du try-on se lance à partir de l’image actuellement sélectionnée.</line><line number="54" /><line number="55">**6. Écran de génération (progression) :**</line><line number="56" /><line number="57">- Une barre de progression s’affiche, indiquant l’état d’avancement (5s à 1min max).</line><line number="58">- Une zone publicitaire est visible sous la barre de progression.</line><line number="59">- Une fois la génération terminée, l’écran principal réapparaît.</line><line number="60" /><line number="61">**7. Retour à l’écran principal (post-génération) :**</line><line number="62" /><line number="63">- La nouvelle image générée est ajoutée juste en dessous de la photo initiale dans l’historique et est automatiquement sélectionnée.</line><line number="64">- L’utilisateur peut de nouveau choisir une autre catégorie, un autre vêtement, ou changer de langue à tout moment.</line><line number="65" /><line number="66">**8. Fin de session :**</line><line number="67" /><line number="68">- Un bouton "Terminer la session" ouvre un modal :</line><line number="69">    - L’utilisateur peut saisir un numéro de téléphone pour recevoir par SMS toutes les images générées.</line><line number="70">    - Un bouton "Confirmer" envoie les images si un numéro est fourni, sinon termine simplement la session.</line><line number="71">    - Un bouton "Retour" permet d’annuler la fin de session et de continuer.</line><line number="72">    - Un message de remerciement s’affiche.</line><line number="73">- Une fois la session terminée, retour à l’écran d’accueil avec la webcam, prêt pour un nouvel utilisateur.</line><line number="74" /><line number="75">---</line><line number="76" /><line number="77">**Contraintes et exigences :**</line><line number="78" /><line number="79">- **Affichage pleine page** :</line><line number="80">    - Toujours en fullscreen sans scroll global.</line><line number="81">    - Les barres d’historique et de sélection de vêtements sont scrollables dans leurs zones dédiées.</line><line number="82">- **Vue webcam immersive** :</line><line number="83">    - Le flux de la webcam occupe 100% de l’écran **uniquement sur l’écran d’accueil et jusqu’à la prise de la photo initiale**.</line><line number="84">    - Après la validation de la photo initiale, la webcam disparaît et le fullscreen est réservé à l’affichage de l’image sélectionnée (initiale ou générée).</line><line number="85">- **Confidentialité** :</line><line number="86">    - Toutes les photos sont sauvegardées en base de données.</line><line number="87">    - Consentement explicite avant la capture.</line><line number="88">    - Les photos ne sont utilisées que dans la session courante, identifiée par un UID unique.</line><line number="89">- **Gestion des sessions** :</line><line number="90">    - Chaque nouvelle photo initiale crée une nouvelle session.</line><line number="91">    - Données de sessions précédentes non accessibles ensuite.</line><line number="92">- **Performances** :</line><line number="93">    - Génération entre 5s et 1min.</line><line number="94">    - Une seule session utilisateur à la fois.</line><line number="95">- **Architecture propre** :</line><line number="96">    - ESModules, code organisé en `components/`, `pages/`, `services/`, `styles/`.</line><line number="97">    - Commentaires clairs.</line><line number="98">- **Publicité pendant la génération** :</line><line number="99">    - Affichage sous la barre de progression, non intrusive.</line><line number="100">- **Expérience utilisateur fluide** :</line><line number="101">    - Feedbacks visuels/sonores.</line><line number="102">    - Boutons grands et adaptés.</line><line number="103">    - Gestion multilingue à tout moment.</line><line number="104">- **Évolutivité** :</line><line number="105">    - Ajout facile de nouvelles catégories, vêtements, langues, fonctionnalités.</line><line number="106" /><line number="107">---</line><line number="108" /><line number="109">**Résumé :**</line><line number="110" /><line number="111">Ce projet fournit une expérience immersive de try-on virtuel avec prise de photo initiale via une webcam, sélection de vêtements par catégorie, génération d’images à partir de l’image initiale ou de toute image déjà générée, et gestion multilingue intégrée. L’interface évolue du flux webcam au début à l’affichage des images sélectionnées ensuite, permet la fin de session avec envoi par SMS, et respecte les contraintes de performances, de confidentialité et d’ergonomie.</line></code></file><file path="scripts/generate_prompt.py"><code language="python"><line number="1">#!/usr/bin/env python3</line><line number="2">import os</line><line number="3">import sys</line><line number="4">import xml.etree.ElementTree as ET</line><line number="5">from jinja2 import Environment, FileSystemLoader</line><line number="6">import yaml</line><line number="7" /><line number="8">def load_xml(file_path):</line><line number="9">    if not os.path.exists(file_path):</line><line number="10">        return None</line><line number="11">    tree = ET.parse(file_path)</line><line number="12">    return tree.getroot()</line><line number="13" /><line number="14">def get_text_from_xpath(root, xpath):</line><line number="15">    elem = root.find(xpath)</line><line number="16">    if elem is not None and elem.text:</line><line number="17">        return elem.text.strip()</line><line number="18">    return ""</line><line number="19" /><line number="20">def get_list_from_xpath(root, xpath):</line><line number="21">    return [e.text.strip() for e in root.findall(xpath)]</line><line number="22" /><line number="23">def parse_code_context(root):</line><line number="24">    files_data = []</line><line number="25">    for f in root.findall("./file"):</line><line number="26">        path = f.get("path", "")</line><line number="27">        code_elem = f.find("./code")</line><line number="28">        language = code_elem.get("language", "none") if code_elem is not None else "none"</line><line number="29">        lines_data = []</line><line number="30">        if code_elem is not None:</line><line number="31">            for line_elem in code_elem.findall("./line"):</line><line number="32">                number = line_elem.get("number", "0")</line><line number="33">                text = line_elem.text if line_elem.text else ""</line><line number="34">                lines_data.append({'number': number, 'text': text})</line><line number="35">        files_data.append({</line><line number="36">            'path': path,</line><line number="37">            'language': language,</line><line number="38">            'lines': lines_data</line><line number="39">        })</line><line number="40">    return files_data</line><line number="41" /><line number="42">def load_settings():</line><line number="43">    with open("config/settings.yaml", "r", encoding="utf-8") as f:</line><line number="44">        data = yaml.safe_load(f)</line><line number="45">    source_directory = data.get("source_directory", ".")</line><line number="46">    exclude_patterns = data.get("exclude_patterns", [])</line><line number="47">    return source_directory, exclude_patterns</line><line number="48" /><line number="49">def main():</line><line number="50">    if len(sys.argv) &lt; 2:</line><line number="51">        print("Error: format argument missing.")</line><line number="52">        sys.exit(1)</line><line number="53" /><line number="54">    chosen_format = sys.argv[1].lower()</line><line number="55" /><line number="56">    project_instructions = load_xml("config/project_instructions.xml")</line><line number="57">    codebase_context = load_xml("config/codebase_context.xml")</line><line number="58">    # On n'utilise plus le settings en XML</line><line number="59">    # On charge juste pour valider le fonctionnement</line><line number="60">    source_directory, exclude_patterns = load_settings()</line><line number="61" /><line number="62">    final_request = load_xml("config/final_request.xml")</line><line number="63">    format_root = load_xml(f"config/formats/{chosen_format}.xml")</line><line number="64" /><line number="65">    code_files = []</line><line number="66">    if os.path.exists("data/code_context.xml"):</line><line number="67">        code_context_root = load_xml("data/code_context.xml")</line><line number="68">        if code_context_root is not None:</line><line number="69">            code_files = parse_code_context(code_context_root)</line><line number="70" /><line number="71">    code_structure = ""</line><line number="72">    if os.path.exists("data/code_structure.xml"):</line><line number="73">        with open("data/code_structure.xml", "r", encoding="utf-8") as f:</line><line number="74">            code_structure = f.read().strip()</line><line number="75" /><line number="76">    project_name = get_text_from_xpath(project_instructions, "./project_name")</line><line number="77">    objectives = get_list_from_xpath(project_instructions, "./objectives/objective")</line><line number="78">    frontend_stack = get_text_from_xpath(project_instructions, "./code_conventions/language_stack/frontend")</line><line number="79">    backend_stack = get_text_from_xpath(project_instructions, "./code_conventions/language_stack/backend")</line><line number="80">    directories_frontend = get_text_from_xpath(project_instructions, "./code_conventions/directories_structure/frontend")</line><line number="81">    directories_backend = get_text_from_xpath(project_instructions, "./code_conventions/directories_structure/backend")</line><line number="82">    coding_style = get_list_from_xpath(project_instructions, "./code_conventions/coding_style/rule")</line><line number="83">    privacy_and_legal = get_list_from_xpath(project_instructions, "./privacy_and_legal/item")</line><line number="84">    performance_and_arch = get_list_from_xpath(project_instructions, "./performance_and_architecture/item")</line><line number="85">    ux_guidelines = get_list_from_xpath(project_instructions, "./ux_guidelines/item")</line><line number="86">    advertising = get_list_from_xpath(project_instructions, "./advertising/item")</line><line number="87">    evolutivity = get_list_from_xpath(project_instructions, "./evolutivity/item")</line><line number="88" /><line number="89">    files_info = codebase_context.findall("./files/file")</line><line number="90" /><line number="91">    request_text = get_text_from_xpath(final_request, "./request")</line><line number="92">    if not request_text:</line><line number="93">        request_text = "Please explain the codebase."</line><line number="94" /><line number="95">    format_instructions = get_list_from_xpath(format_root, "./instructions/instruction")</line><line number="96">    format_examples = get_list_from_xpath(format_root, "./examples/example")</line><line number="97" /><line number="98">    env = Environment(loader=FileSystemLoader("templates"))</line><line number="99">    template = env.get_template("prompt_template.xml.jinja2")</line><line number="100" /><line number="101">    prompt = template.render(</line><line number="102">        project_name=project_name,</line><line number="103">        objectives=objectives,</line><line number="104">        frontend_stack=frontend_stack,</line><line number="105">        backend_stack=backend_stack,</line><line number="106">        directories_frontend=directories_frontend,</line><line number="107">        directories_backend=directories_backend,</line><line number="108">        coding_style=coding_style,</line><line number="109">        privacy_and_legal=privacy_and_legal,</line><line number="110">        performance_and_arch=performance_and_arch,</line><line number="111">        ux_guidelines=ux_guidelines,</line><line number="112">        advertising=advertising,</line><line number="113">        evolutivity=evolutivity,</line><line number="114">        code_structure=code_structure,</line><line number="115">        files_info=files_info,</line><line number="116">        code_files=code_files,</line><line number="117">        request=request_text,</line><line number="118">        chosen_format=chosen_format,</line><line number="119">        format_instructions=format_instructions,</line><line number="120">        format_examples=format_examples</line><line number="121">    )</line><line number="122" /><line number="123">    print(prompt)</line><line number="124" /><line number="125">if __name__ == "__main__":</line><line number="126">    main()</line><line number="127" /></code></file><file path="scripts/generate_structure.py"><code language="python"><line number="1">#!/usr/bin/env python3</line><line number="2">import os</line><line number="3">import fnmatch</line><line number="4">import sys</line><line number="5">import yaml</line><line number="6">import xml.etree.ElementTree as ET</line><line number="7" /><line number="8">def load_settings():</line><line number="9">    with open("config/settings.yaml", "r", encoding="utf-8") as f:</line><line number="10">        data = yaml.safe_load(f)</line><line number="11">    source_directory = data.get("source_directory", ".")</line><line number="12">    exclude_patterns = data.get("exclude_patterns", [])</line><line number="13">    return source_directory, exclude_patterns</line><line number="14" /><line number="15">def is_excluded(path, exclude_patterns):</line><line number="16">    norm_path = path.replace("\\", "/")</line><line number="17">    for pattern in exclude_patterns:</line><line number="18">        if fnmatch.fnmatch(norm_path, pattern) or pattern in norm_path:</line><line number="19">            return True</line><line number="20">    return False</line><line number="21" /><line number="22">def detect_language(extension):</line><line number="23">    lang_map = {</line><line number="24">        ".js": "javascript",</line><line number="25">        ".jsx": "javascript",</line><line number="26">        ".ts": "typescript",</line><line number="27">        ".tsx": "typescript",</line><line number="28">        ".py": "python",</line><line number="29">        ".html": "html",</line><line number="30">        ".css": "css",</line><line number="31">        ".json": "json",</line><line number="32">        ".yaml": "yaml",</line><line number="33">        ".yml": "yaml",</line><line number="34">        ".md": "markdown"</line><line number="35">    }</line><line number="36">    return lang_map.get(extension, "")</line><line number="37" /><line number="38">def is_too_high_in_hierarchy(source_dir):</line><line number="39">    forbidden_paths = ["/", "/home"]</line><line number="40">    abs_source = os.path.abspath(source_dir)</line><line number="41">    return abs_source in forbidden_paths</line><line number="42" /><line number="43">def main():</line><line number="44">    source_directory, exclude_patterns = load_settings()</line><line number="45" /><line number="46">    abs_source = os.path.abspath(source_directory)</line><line number="47">    print(f"About to scan: {abs_source}")</line><line number="48" /><line number="49">    if is_too_high_in_hierarchy(source_directory):</line><line number="50">        print("Error: The source directory is too high.")</line><line number="51">        sys.exit(1)</line><line number="52" /><line number="53">    code_structure = ET.Element("code_structure")</line><line number="54">    code_context = ET.Element("code_context")</line><line number="55" /><line number="56">    if not os.path.exists("data"):</line><line number="57">        os.makedirs("data")</line><line number="58" /><line number="59">    for root, dirs, files in os.walk(source_directory, topdown=True):</line><line number="60">        dirs[:] = [d for d in dirs if not is_excluded(os.path.join(root, d), exclude_patterns)]</line><line number="61">        for filename in files:</line><line number="62">            full_path = os.path.join(root, filename)</line><line number="63">            rel_path = os.path.relpath(full_path, source_directory)</line><line number="64">            if is_excluded(rel_path, exclude_patterns):</line><line number="65">                continue</line><line number="66" /><line number="67">            item = ET.SubElement(code_structure, "file")</line><line number="68">            item.text = rel_path</line><line number="69" /><line number="70">            _, ext = os.path.splitext(filename)</line><line number="71">            code_lang = detect_language(ext)</line><line number="72" /><line number="73">            try:</line><line number="74">                with open(full_path, "r", encoding="utf-8", errors="ignore") as fc:</line><line number="75">                    content = fc.read()</line><line number="76">            except Exception as e:</line><line number="77">                content = f"Could not read file: {e}"</line><line number="78" /><line number="79">            file_elem = ET.SubElement(code_context, "file")</line><line number="80">            file_elem.set("path", rel_path)</line><line number="81">            code_block = ET.SubElement(file_elem, "code")</line><line number="82">            code_block.set("language", code_lang if code_lang else "none")</line><line number="83">            lines = content.split('\n')</line><line number="84">            for i, line in enumerate(lines, start=1):</line><line number="85">                line_elem = ET.SubElement(code_block, "line")</line><line number="86">                line_elem.set("number", str(i))</line><line number="87">                line_elem.text = line</line><line number="88" /><line number="89">    ET.ElementTree(code_structure).write("data/code_structure.xml", encoding="utf-8", xml_declaration=True)</line><line number="90">    ET.ElementTree(code_context).write("data/code_context.xml", encoding="utf-8", xml_declaration=True)</line><line number="91" /><line number="92">    print("Code structure and context generated successfully.")</line><line number="93" /><line number="94">if __name__ == "__main__":</line><line number="95">    main()</line><line number="96" /></code></file><file path="templates/prompt_template.xml.jinja2"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;prompt&gt;</line><line number="3">  &lt;project_instructions&gt;</line><line number="4">    &lt;project_name&gt;{{ project_name }}&lt;/project_name&gt;</line><line number="5">    &lt;objectives&gt;</line><line number="6">      {% for obj in objectives %}</line><line number="7">      &lt;objective&gt;{{ obj }}&lt;/objective&gt;</line><line number="8">      {% endfor %}</line><line number="9">    &lt;/objectives&gt;</line><line number="10">    &lt;code_conventions&gt;</line><line number="11">      &lt;language_stack&gt;</line><line number="12">        &lt;frontend&gt;{{ frontend_stack }}&lt;/frontend&gt;</line><line number="13">        &lt;backend&gt;{{ backend_stack }}&lt;/backend&gt;</line><line number="14">      &lt;/language_stack&gt;</line><line number="15">      &lt;directories_structure&gt;</line><line number="16">        &lt;frontend&gt;{{ directories_frontend }}&lt;/frontend&gt;</line><line number="17">        &lt;backend&gt;{{ directories_backend }}&lt;/backend&gt;</line><line number="18">      &lt;/directories_structure&gt;</line><line number="19">      &lt;coding_style&gt;</line><line number="20">        {% for rule in coding_style %}</line><line number="21">        &lt;rule&gt;{{ rule }}&lt;/rule&gt;</line><line number="22">        {% endfor %}</line><line number="23">      &lt;/coding_style&gt;</line><line number="24">    &lt;/code_conventions&gt;</line><line number="25">    &lt;privacy_and_legal&gt;</line><line number="26">      {% for pl in privacy_and_legal %}</line><line number="27">      &lt;item&gt;{{ pl }}&lt;/item&gt;</line><line number="28">      {% endfor %}</line><line number="29">    &lt;/privacy_and_legal&gt;</line><line number="30">    &lt;performance_and_architecture&gt;</line><line number="31">      {% for pa in performance_and_arch %}</line><line number="32">      &lt;item&gt;{{ pa }}&lt;/item&gt;</line><line number="33">      {% endfor %}</line><line number="34">    &lt;/performance_and_architecture&gt;</line><line number="35">    &lt;ux_guidelines&gt;</line><line number="36">      {% for ux in ux_guidelines %}</line><line number="37">      &lt;item&gt;{{ ux }}&lt;/item&gt;</line><line number="38">      {% endfor %}</line><line number="39">    &lt;/ux_guidelines&gt;</line><line number="40">    &lt;advertising&gt;</line><line number="41">      {% for ad in advertising %}</line><line number="42">      &lt;item&gt;{{ ad }}&lt;/item&gt;</line><line number="43">      {% endfor %}</line><line number="44">    &lt;/advertising&gt;</line><line number="45">    &lt;evolutivity&gt;</line><line number="46">      {% for ev in evolutivity %}</line><line number="47">      &lt;item&gt;{{ ev }}&lt;/item&gt;</line><line number="48">      {% endfor %}</line><line number="49">    &lt;/evolutivity&gt;</line><line number="50">  &lt;/project_instructions&gt;</line><line number="51" /><line number="52">  &lt;project_structure&gt;</line><line number="53">    {{ code_structure | safe }}</line><line number="54">  &lt;/project_structure&gt;</line><line number="55" /><line number="56">  &lt;codebase_context&gt;</line><line number="57">    &lt;files&gt;</line><line number="58">    {% for f in files_info %}</line><line number="59">      &lt;file&gt;</line><line number="60">        &lt;path&gt;{{ f.find('path').text.strip() }}&lt;/path&gt;</line><line number="61">        &lt;description&gt;{{ f.find('description').text.strip() }}&lt;/description&gt;</line><line number="62">      &lt;/file&gt;</line><line number="63">    {% endfor %}</line><line number="64">    &lt;/files&gt;</line><line number="65">  &lt;/codebase_context&gt;</line><line number="66" /><line number="67">  &lt;full_code_context&gt;</line><line number="68">    &lt;files&gt;</line><line number="69">    {% for file_item in code_files %}</line><line number="70">      &lt;file&gt;</line><line number="71">        &lt;path&gt;{{ file_item.path }}&lt;/path&gt;</line><line number="72">        &lt;language&gt;{{ file_item.language }}&lt;/language&gt;</line><line number="73">        &lt;lines&gt;</line><line number="74">          {% for line in file_item.lines %}</line><line number="75">          &lt;line number="{{ line.number }}"&gt;{{ line.text }}&lt;/line&gt;</line><line number="76">          {% endfor %}</line><line number="77">        &lt;/lines&gt;</line><line number="78">      &lt;/file&gt;</line><line number="79">    {% endfor %}</line><line number="80">    &lt;/files&gt;</line><line number="81">  &lt;/full_code_context&gt;</line><line number="82" /><line number="83">  &lt;format&gt;</line><line number="84">    &lt;selected&gt;{{ chosen_format }}&lt;/selected&gt;</line><line number="85">    &lt;instructions&gt;</line><line number="86">      {% for instr in format_instructions %}</line><line number="87">      &lt;instruction&gt;{{ instr }}&lt;/instruction&gt;</line><line number="88">      {% endfor %}</line><line number="89">    &lt;/instructions&gt;</line><line number="90">    &lt;examples&gt;</line><line number="91">      {% for ex in format_examples %}</line><line number="92">      &lt;example&gt;{{ ex }}&lt;/example&gt;</line><line number="93">      {% endfor %}</line><line number="94">    &lt;/examples&gt;</line><line number="95">  &lt;/format&gt;</line><line number="96" /><line number="97">  &lt;request&gt;</line><line number="98">    {{ request }}</line><line number="99">  &lt;/request&gt;</line><line number="100">&lt;/prompt&gt;</line><line number="101" /></code></file><file path="config/final_request.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;final_request&gt;</line><line number="3">  &lt;request&gt;</line><line number="4">   J'ai applique tes modification mais cela ne fonctionne pas. </line><line number="5">  &lt;/request&gt;</line><line number="6">&lt;/final_request&gt;</line><line number="7" /></code></file><file path="config/settings.yaml"><code language="yaml"><line number="1">source_directory: "."</line><line number="2">exclude_patterns:</line><line number="3">  - data</line><line number="4">  - .git</line><line number="5">  - .github</line><line number="6">  - .vscode</line><line number="7">  - .idea</line><line number="8">  - .husky</line><line number="9">  - venv</line><line number="10">  - node_modules</line><line number="11">  - dist</line><line number="12">  - build</line><line number="13">  - coverage</line><line number="14">  - .cache</line><line number="15">  - out</line><line number="16">  - "*.log"</line><line number="17">  - ".DS_Store"</line><line number="18">  - "Thumbs.db"</line><line number="19">  - ".env"</line><line number="20">  - ".env.*"</line><line number="21">  - "yarn.lock"</line><line number="22">  - "package-lock.json"</line><line number="23">  - "*.tmp"</line><line number="24">  - "*.bak"</line><line number="25">  - "*.swp"</line><line number="26" /></code></file><file path="config/project_instructions.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;project_instructions&gt;</line><line number="3">  &lt;project_name&gt;Immersive Try-On Kiosk&lt;/project_name&gt;</line><line number="4">  &lt;objectives&gt;</line><line number="5">    &lt;objective&gt;Provide an immersive and fluent user experience to virtually try on clothing.&lt;/objective&gt;</line><line number="6">    &lt;objective&gt;Ensure a complete workflow: from initial photo capture to generating multiple try-on images.&lt;/objective&gt;</line><line number="7">    &lt;objective&gt;Facilitate easy addition of new clothing categories, items, and languages.&lt;/objective&gt;</line><line number="8">  &lt;/objectives&gt;</line><line number="9">  &lt;code_conventions&gt;</line><line number="10">    &lt;language_stack&gt;</line><line number="11">      &lt;frontend&gt;React (ESModules, functional components)&lt;/frontend&gt;</line><line number="12">      &lt;backend&gt;Node.js / Express&lt;/backend&gt;</line><line number="13">    &lt;/language_stack&gt;</line><line number="14">    &lt;directories_structure&gt;</line><line number="15">      &lt;frontend&gt;src/components, src/pages, src/services, src/styles&lt;/frontend&gt;</line><line number="16">      &lt;backend&gt;src/routes, src/controllers, src=models, src=services&lt;/backend&gt;</line><line number="17">    &lt;/directories_structure&gt;</line><line number="18">    &lt;coding_style&gt;</line><line number="19">      &lt;rule&gt;Follow ES6 conventions&lt;/rule&gt;</line><line number="20">      &lt;rule&gt;Write clean, well-commented, and readable code&lt;/rule&gt;</line><line number="21">      &lt;rule&gt;Separate business logic from presentation&lt;/rule&gt;</line><line number="22">      &lt;rule&gt;Use hooks and context for state management if necessary&lt;/rule&gt;</line><line number="23">    &lt;/coding_style&gt;</line><line number="24">  &lt;/code_conventions&gt;</line><line number="25">  &lt;privacy_and_legal&gt;</line><line number="26">    &lt;item&gt;Obtain explicit consent before capturing and saving photos&lt;/item&gt;</line><line number="27">    &lt;item&gt;Save each session and its associated images in the database&lt;/item&gt;</line><line number="28">    &lt;item&gt;No reuse of images outside the current session&lt;/item&gt;</line><line number="29">  &lt;/privacy_and_legal&gt;</line><line number="30">  &lt;performance_and_architecture&gt;</line><line number="31">    &lt;item&gt;Image generation should take between 5s and 1min max&lt;/item&gt;</line><line number="32">    &lt;item&gt;Only one user session at a time&lt;/item&gt;</line><line number="33">    &lt;item&gt;Maintain a clean, modular, and maintainable codebase&lt;/item&gt;</line><line number="34">  &lt;/performance_and_architecture&gt;</line><line number="35">  &lt;ux_guidelines&gt;</line><line number="36">    &lt;item&gt;Fullscreen interface without global scroll&lt;/item&gt;</line><line number="37">    &lt;item&gt;Smooth navigation, visual and audio feedback&lt;/item&gt;</line><line number="38">    &lt;item&gt;Large buttons, clear text&lt;/item&gt;</line><line number="39">    &lt;item&gt;On-the-fly language switching&lt;/item&gt;</line><line number="40">    &lt;item&gt;Scrollable sidebars for history and item selection&lt;/item&gt;</line><line number="41">  &lt;/ux_guidelines&gt;</line><line number="42">  &lt;advertising&gt;</line><line number="43">    &lt;item&gt;Display a non-intrusive ad during image generation&lt;/item&gt;</line><line number="44">  &lt;/advertising&gt;</line><line number="45">  &lt;evolutivity&gt;</line><line number="46">    &lt;item&gt;Add new categories, items, and languages easily&lt;/item&gt;</line><line number="47">    &lt;item&gt;Maintain a code structure that supports future extensions&lt;/item&gt;</line><line number="48">  &lt;/evolutivity&gt;</line><line number="49">&lt;/project_instructions&gt;</line><line number="50" /></code></file><file path="config/codebase_context.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;codebase_context&gt;</line><line number="3">  &lt;files&gt;</line><line number="4">    &lt;file&gt;</line><line number="5">      &lt;path&gt;frontend/src/pages/Home.js&lt;/path&gt;</line><line number="6">      &lt;description&gt;Displays webcam feed, 'Let's Play' button, and language switcher at startup.&lt;/description&gt;</line><line number="7">    &lt;/file&gt;</line><line number="8">    &lt;file&gt;</line><line number="9">      &lt;path&gt;frontend/src/pages/ConsentModal.js&lt;/path&gt;</line><line number="10">      &lt;description&gt;Handles legal consent before taking and saving photos.&lt;/description&gt;</line><line number="11">    &lt;/file&gt;</line><line number="12">    &lt;file&gt;</line><line number="13">      &lt;path&gt;frontend/src/pages/TutorialAndCountdown.js&lt;/path&gt;</line><line number="14">      &lt;description&gt;Shows a countdown and tutorial overlay to guide user positioning before photo capture.&lt;/description&gt;</line><line number="15">    &lt;/file&gt;</line><line number="16">    &lt;file&gt;</line><line number="17">      &lt;path&gt;frontend/src/pages/PhotoValidation.js&lt;/path&gt;</line><line number="18">      &lt;description&gt;Displays the captured photo, allowing confirmation or retaking.&lt;/description&gt;</line><line number="19">    &lt;/file&gt;</line><line number="20">    &lt;file&gt;</line><line number="21">      &lt;path&gt;frontend/src/pages/MainScreen.js&lt;/path&gt;</line><line number="22">      &lt;description&gt;Main interface after initial photo validation, shows selected image, history of generated images, and item/category selection.&lt;/description&gt;</line><line number="23">    &lt;/file&gt;</line><line number="24">    &lt;file&gt;</line><line number="25">      &lt;path&gt;frontend/src/components/LanguageSwitcher.js&lt;/path&gt;</line><line number="26">      &lt;description&gt;Allows user to switch languages at any time.&lt;/description&gt;</line><line number="27">    &lt;/file&gt;</line><line number="28">    &lt;file&gt;</line><line number="29">      &lt;path&gt;frontend/src/components/CategorySelector.js&lt;/path&gt;</line><line number="30">      &lt;description&gt;Displays clothing categories and triggers a modal for item selection.&lt;/description&gt;</line><line number="31">    &lt;/file&gt;</line><line number="32">    &lt;file&gt;</line><line number="33">      &lt;path&gt;frontend/src/components/ClothesModal.js&lt;/path&gt;</line><line number="34">      &lt;description&gt;Transparent modal listing available items for the selected category.&lt;/description&gt;</line><line number="35">    &lt;/file&gt;</line><line number="36">    &lt;file&gt;</line><line number="37">      &lt;path&gt;frontend/src/services/api.js&lt;/path&gt;</line><line number="38">      &lt;description&gt;Handles communication with backend (Node.js/Express) for image saving and retrieval.&lt;/description&gt;</line><line number="39">    &lt;/file&gt;</line><line number="40">    &lt;file&gt;</line><line number="41">      &lt;path&gt;backend/src/routes/sessionRoutes.js&lt;/path&gt;</line><line number="42">      &lt;description&gt;Defines routes for session creation, photo saving, and image retrieval.&lt;/description&gt;</line><line number="43">    &lt;/file&gt;</line><line number="44">    &lt;file&gt;</line><line number="45">      &lt;path&gt;backend/src/controllers/sessionController.js&lt;/path&gt;</line><line number="46">      &lt;description&gt;Implements business logic for managing sessions and photos.&lt;/description&gt;</line><line number="47">    &lt;/file&gt;</line><line number="48">    &lt;file&gt;</line><line number="49">      &lt;path&gt;backend/src/services/imageGeneration.js&lt;/path&gt;</line><line number="50">      &lt;description&gt;Interfaces with the image generation engine (AI) to create try-on outputs.&lt;/description&gt;</line><line number="51">    &lt;/file&gt;</line><line number="52">  &lt;/files&gt;</line><line number="53">&lt;/codebase_context&gt;</line><line number="54" /></code></file><file path="config/formats/xml.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;format&gt;</line><line number="3">  &lt;instructions&gt;</line><line number="4">    &lt;instruction&gt;Use XML tags to structure your response.&lt;/instruction&gt;</line><line number="5">    &lt;instruction&gt;Use &amp;lt;code&amp;gt; elements for code samples.&lt;/instruction&gt;</line><line number="6">  &lt;/instructions&gt;</line><line number="7">  &lt;examples&gt;</line><line number="8">    &lt;example&gt;&amp;lt;example&amp;gt;&lt;/example&gt;</line><line number="9">    &lt;example&gt;  &amp;lt;title&amp;gt;Title&amp;lt;/title&amp;gt;&lt;/example&gt;</line><line number="10">    &lt;example&gt;  &amp;lt;list&amp;gt;&lt;/example&gt;</line><line number="11">    &lt;example&gt;    &amp;lt;item&amp;gt;Bullet point&amp;lt;/item&amp;gt;&lt;/example&gt;</line><line number="12">    &lt;example&gt;  &amp;lt;/list&amp;gt;&lt;/example&gt;</line><line number="13">    &lt;example&gt;&amp;lt;/example&amp;gt;&lt;/example&gt;</line><line number="14">  &lt;/examples&gt;</line><line number="15">&lt;/format&gt;</line><line number="16" /></code></file><file path="config/formats/diff.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;format&gt;</line><line number="3">  &lt;instructions&gt;</line><line number="4">    &lt;instruction&gt;Provide all code changes as a unified diff (patch) format.&lt;/instruction&gt;</line><line number="5">    &lt;instruction&gt;Include all modifications for all files in a single ```diff code block.&lt;/instruction&gt;</line><line number="6">    &lt;instruction&gt;Do not provide explanations outside the diff code block.&lt;/instruction&gt;</line><line number="7">  &lt;/instructions&gt;</line><line number="8">  &lt;examples&gt;</line><line number="9">    &lt;example&gt;```diff&lt;/example&gt;</line><line number="10">    &lt;example&gt;--- a/path/to/original/file.js&lt;/example&gt;</line><line number="11">    &lt;example&gt;+++ b/path/to/original/file.js&lt;/example&gt;</line><line number="12">    &lt;example&gt;@@ -10,7 +10,7 @@&lt;/example&gt;</line><line number="13">    &lt;example&gt;-old line&lt;/example&gt;</line><line number="14">    &lt;example&gt;+new line&lt;/example&gt;</line><line number="15">    &lt;example&gt;```&lt;/example&gt;</line><line number="16">  &lt;/examples&gt;</line><line number="17">&lt;/format&gt;</line><line number="18" /></code></file><file path="config/formats/none.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;format&gt;</line><line number="3">  &lt;instructions&gt;</line><line number="4">    &lt;instruction&gt;No specific formatting.&lt;/instruction&gt;</line><line number="5">  &lt;/instructions&gt;</line><line number="6">  &lt;examples&gt;</line><line number="7">    &lt;example&gt;Just plain text without special formatting.&lt;/example&gt;</line><line number="8">  &lt;/examples&gt;</line><line number="9">&lt;/format&gt;</line><line number="10" /></code></file><file path="config/formats/markdown.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;format&gt;</line><line number="3">  &lt;instructions&gt;</line><line number="4">    &lt;instruction&gt;Use Markdown syntax.&lt;/instruction&gt;</line><line number="5">    &lt;instruction&gt;Include code blocks with ```language for code samples.&lt;/instruction&gt;</line><line number="6">  &lt;/instructions&gt;</line><line number="7">  &lt;examples&gt;</line><line number="8">    &lt;example&gt;**Example (Markdown)**&lt;/example&gt;</line><line number="9">    &lt;example&gt;```markdown&lt;/example&gt;</line><line number="10">    &lt;example&gt;# Title&lt;/example&gt;</line><line number="11">    &lt;example&gt;- Bullet point&lt;/example&gt;</line><line number="12">    &lt;example&gt;```&lt;/example&gt;</line><line number="13">  &lt;/examples&gt;</line><line number="14">&lt;/format&gt;</line><line number="15" /></code></file><file path="config/formats/json.xml"><code language="none"><line number="1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</line><line number="2">&lt;format&gt;</line><line number="3">  &lt;instructions&gt;</line><line number="4">    &lt;instruction&gt;Use JSON formatting.&lt;/instruction&gt;</line><line number="5">    &lt;instruction&gt;Present keys and values in a JSON structure.&lt;/instruction&gt;</line><line number="6">  &lt;/instructions&gt;</line><line number="7">  &lt;examples&gt;</line><line number="8">    &lt;example&gt;{&lt;/example&gt;</line><line number="9">    &lt;example&gt;"title": "Title",&lt;/example&gt;</line><line number="10">    &lt;example&gt;"items": ["Bullet point"]&lt;/example&gt;</line><line number="11">    &lt;example&gt;}&lt;/example&gt;</line><line number="12">  &lt;/examples&gt;</line><line number="13">&lt;/format&gt;</line><line number="14" /></code></file></code_context>